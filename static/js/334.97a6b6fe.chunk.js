"use strict";(self.webpackChunkpersonal_finance_tracker=self.webpackChunkpersonal_finance_tracker||[]).push([[334],{5983:(e,t,r)=>{r.d(t,{A:()=>u});var a=r(9379),s=r(5043),d=r(256),l=r(7669),o=r(6478),i=r(2107),n=r(3709),c=r(2031),m=r(579);const u=()=>{const{userId:e,refetchPurchases:t}=(0,c.E)(),r=(0,s.useRef)(null),[u,x]=(0,s.useState)(""),[h,g]=(0,s.useState)({itemName:"",cost:"",date:""}),[b,p]=(0,s.useState)([]),[k,v]=(0,s.useState)([]),[y,j]=(0,s.useState)(""),f=e=>{try{if(!e.trim())return void j("No data provided");const t=(e=>{const t=e.split("\n")[0];if(!t)return null;const r=["\t",",",";"].map((e=>({delimiter:e,count:(t.match(new RegExp(e,"g"))||[]).length}))).reduce(((e,t)=>t.count>e.count?t:e),{delimiter:null,count:0});return r.count>0?r.delimiter:null})(e);if(!t)return void j("Could not detect a valid delimiter (tab, comma, or semicolon)");const r=e.trim().split("\n").map((e=>e.trim()));if(r.length<2)return void j("At least two lines are required (headers and data)");const a=r[0].split(t).map((e=>e.trim()));if(a.length<2)return void j("Only found ".concat(a.length," column(s). Please check the format."));const s=r.slice(1).map((e=>{const r=e.split(t).map((e=>e.trim()));return a.reduce(((e,t,a)=>(e[t]=r[a]||"",e)),{})}));v(a),p(s),j("")}catch(t){console.error("Parsing error:",t),j("Parsing error: ".concat(t.message)),p([])}},w=(e,t)=>{g((r=>(0,a.A)((0,a.A)({},r),{},{[e]:t})))},N=e=>{if(!e)return(new Date).toISOString();const t=new Date(e);return isNaN(t.getTime())?(new Date).toISOString():t.toISOString()};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("button",{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.showModal()},className:"w-full bg-green-500 dark:bg-green-600 text-white py-2 rounded-md hover:bg-green-600 dark:hover:bg-green-700 transition-colors flex items-center justify-center mt-4",children:[(0,m.jsx)(d.A,{className:"mr-2",size:20}),"Bulk Import"]}),(0,m.jsx)("dialog",{ref:r,className:"w-full max-w-3xl rounded-lg p-6 backdrop:bg-black backdrop:bg-opacity-50 bg-white dark:bg-slate-800",children:(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[(0,m.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Bulk Import Purchases"}),(0,m.jsx)("button",{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.close()},className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:(0,m.jsx)(l.A,{size:20})})]}),y&&(0,m.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 dark:border-red-600 p-4 text-red-700 dark:text-red-300",children:(0,m.jsxs)("div",{className:"flex",children:[(0,m.jsx)(o.A,{className:"h-5 w-5 mr-2"}),(0,m.jsx)("span",{children:y})]})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200",children:"Paste your data (tab, comma, or semicolon separated):"}),(0,m.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:["Example format:",(0,m.jsx)("br",{}),"Item Name,Cost,Date",(0,m.jsx)("br",{}),"Groceries,45.99,2024-02-14"]}),(0,m.jsx)("textarea",{value:u,onChange:e=>{const t=e.target.value;x(t),f(t)},className:"w-full h-32 p-2 border dark:border-gray-600 rounded-md font-mono text-sm bg-white dark:bg-slate-700 text-gray-800 dark:text-white",placeholder:"Item Name,Cost,Date"})]}),k.length>0&&(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsx)("h3",{className:"font-medium text-gray-800 dark:text-white",children:"Map Columns"}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-200",children:"Item Name*"}),(0,m.jsxs)("select",{value:h.itemName,onChange:e=>w("itemName",e.target.value),className:"w-full p-2 border dark:border-gray-600 rounded-md bg-white dark:bg-slate-700 text-gray-800 dark:text-white",children:[(0,m.jsx)("option",{value:"",children:"Select column"}),k.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-200",children:"Cost*"}),(0,m.jsxs)("select",{value:h.cost,onChange:e=>w("cost",e.target.value),className:"w-full p-2 border dark:border-gray-600 rounded-md bg-white dark:bg-slate-700 text-gray-800 dark:text-white",children:[(0,m.jsx)("option",{value:"",children:"Select column"}),k.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-200",children:"Date (Optional)"}),(0,m.jsxs)("select",{value:h.date,onChange:e=>w("date",e.target.value),className:"w-full p-2 border dark:border-gray-600 rounded-md bg-white dark:bg-slate-700 text-gray-800 dark:text-white",children:[(0,m.jsx)("option",{value:"",children:"Select column"}),k.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]})]})]}),b.length>0&&(0,m.jsxs)("div",{children:[(0,m.jsxs)("h3",{className:"font-medium mb-2 text-gray-800 dark:text-white",children:["Preview (",b.length," rows)"]}),(0,m.jsx)("div",{className:"max-h-48 overflow-auto border dark:border-gray-600 rounded-md",children:(0,m.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[(0,m.jsx)("thead",{className:"bg-gray-50 dark:bg-slate-700",children:(0,m.jsx)("tr",{children:k.map((e=>(0,m.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e},e)))})}),(0,m.jsx)("tbody",{className:"bg-white dark:bg-slate-600 divide-y divide-gray-200 dark:divide-gray-600",children:b.slice(0,5).map(((e,t)=>(0,m.jsx)("tr",{children:k.map((t=>(0,m.jsx)("td",{className:"px-4 py-2 text-sm text-gray-800 dark:text-white",children:e[t]},t)))},t)))})]})})]})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-2 mt-4 pt-4 border-t dark:border-gray-600",children:[(0,m.jsxs)("button",{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.close()},className:"px-4 py-2 border dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-800 dark:text-white",children:[(0,m.jsx)(l.A,{className:"mr-2 inline-block",size:16}),"Cancel"]}),(0,m.jsxs)("button",{onClick:async()=>{const t=h.itemName?h.cost?null:"Cost mapping is required":"Item Name mapping is required";if(t)j(t);else try{var a;const t=b.map((t=>{var r;return{item_name:(null===(r=t[h.itemName])||void 0===r?void 0:r.trim())||"",cost:parseFloat(t[h.cost])||0,user_id:e,budget_item_id:null,timestamp:N(h.date?t[h.date]:null)}})).filter((e=>e.item_name&&!isNaN(e.cost))),{error:s}=await n.A.from("purchases").insert(t);if(s)throw s;alert("Purchases imported successfully!"),null===(a=r.current)||void 0===a||a.close(),x(""),p([]),g({itemName:"",cost:"",date:""})}catch(y){console.error("Error importing purchases:",y),j("Failed to import purchases. Please try again.")}},disabled:!b.length||!h.itemName||!h.cost,className:"px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded-md hover:bg-blue-600 dark:hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,m.jsx)(i.A,{className:"mr-2 inline-block",size:16}),"Import"]})]})]})})]})}},8334:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var a=r(5043),s=r(6983),d=r(920),l=r(7473),o=r(7750),i=r(1238),n=r(3709),c=r(5983),m=r(205),u=r(579);const x=()=>{const[e,t]=(0,a.useState)(null),{theme:r,setTheme:x}=(0,m.D)(),[h,g]=(0,a.useState)(!1);(0,a.useEffect)((()=>{g(!0)}),[]),(0,a.useEffect)((()=>{(async()=>{const{data:{user:e}}=await n.A.auth.getUser();e&&t(e.id)})()}),[]);return(0,u.jsxs)("div",{className:"w-full mx-auto p-6 bg-white dark:bg-slate-800 shadow-lg rounded-lg",children:[(0,u.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-800 dark:text-white mb-6",children:"Settings"}),(0,u.jsxs)("div",{className:"space-y-4",children:[h&&(0,u.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-md",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Dark Mode"}),(0,u.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Toggle dark/light theme"})]}),(0,u.jsx)("button",{onClick:()=>x("dark"===r?"light":"dark"),className:"p-2 rounded-lg bg-gray-200 dark:bg-slate-600 hover:bg-gray-300 dark:hover:bg-slate-500 transition-colors","aria-label":"Toggle theme",children:"dark"===r?(0,u.jsx)(s.A,{className:"w-5 h-5 text-gray-700 dark:text-gray-200"}):(0,u.jsx)(d.A,{className:"w-5 h-5 text-gray-700 dark:text-gray-200"})})]}),(0,u.jsxs)("button",{onClick:async()=>{try{const{data:t,error:r}=await n.A.from("budget_groups").select("*").eq("id",e);if(r)throw r;const{data:a,error:s}=await n.A.from("budget_items").select("*").eq("id",e);if(s)throw s;const{data:d,error:l}=await n.A.from("purchases").select("*").eq("id",e);if(l)throw l;const o=a.map((e=>{const r=t.find((t=>t.id===e.group_id));return{Group:(null===r||void 0===r?void 0:r.name)||"Unknown",ItemName:e.name,Budget:e.budget,ItemID:e.id}})),c=d.map((e=>({ItemName:e.item_name,Cost:e.cost,BudgetGroup:e.budget_item_id,Timestamp:new Date(e.timestamp).toLocaleString()}))),m=i.Wp.book_new(),u=i.Wp.json_to_sheet(o);i.Wp.book_append_sheet(m,u,"Budget Items");const x=i.Wp.json_to_sheet(c);i.Wp.book_append_sheet(m,x,"Purchases");const h=i.Wp.json_to_sheet(t);i.Wp.book_append_sheet(m,h,"Budget Groups"),i._h(m,"Budget_Export.xlsx")}catch(t){throw console.error("Error exporting data to Excel: ",t),t}},className:"w-full flex items-center justify-center gap-2 p-2 text-sm font-medium text-white bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 dark:hover:bg-blue-800 rounded-md transition-colors",children:[(0,u.jsx)(l.A,{className:"w-4 h-4"}),"Export Data"]}),(0,u.jsx)(c.A,{}),(0,u.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4",children:(0,u.jsxs)("button",{onClick:async()=>{try{const{error:e}=await n.A.auth.signOut();if(e)throw e;window.location.href="/"}catch(e){console.error("Error signing out:",e)}},className:"w-full flex items-center justify-center gap-2 p-2 text-sm font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors",children:[(0,u.jsx)(o.A,{className:"w-4 h-4"}),"Sign Out"]})})]})]})}}}]);
//# sourceMappingURL=334.97a6b6fe.chunk.js.map