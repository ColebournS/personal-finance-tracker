"use strict";(self.webpackChunkpersonal_finance_tracker=self.webpackChunkpersonal_finance_tracker||[]).push([[88],{5983:(e,t,r)=>{r.d(t,{A:()=>u});var s=r(9379),a=r(5043),n=r(256),o=r(7669),l=r(6478),i=r(4488),c=r(3709),d=r(2031),m=r(579);const u=()=>{const{userId:e,refetchPurchases:t}=(0,d.E)(),r=(0,a.useRef)(null),[u,h]=(0,a.useState)(""),[x,p]=(0,a.useState)({itemName:"",cost:"",date:""}),[g,f]=(0,a.useState)([]),[b,j]=(0,a.useState)([]),[v,N]=(0,a.useState)(""),w=e=>{try{if(!e.trim())return void N("No data provided");const t=(e=>{const t=e.split("\n")[0];if(!t)return null;const r=["\t",",",";"].map((e=>({delimiter:e,count:(t.match(new RegExp(e,"g"))||[]).length}))).reduce(((e,t)=>t.count>e.count?t:e),{delimiter:null,count:0});return r.count>0?r.delimiter:null})(e);if(!t)return void N("Could not detect a valid delimiter (tab, comma, or semicolon)");const r=e.trim().split("\n").map((e=>e.trim()));if(r.length<2)return void N("At least two lines are required (headers and data)");const s=r[0].split(t).map((e=>e.trim()));if(s.length<2)return void N("Only found ".concat(s.length," column(s). Please check the format."));const a=r.slice(1).map((e=>{const r=e.split(t).map((e=>e.trim()));return s.reduce(((e,t,s)=>(e[t]=r[s]||"",e)),{})}));j(s),f(a),N("")}catch(t){console.error("Parsing error:",t),N("Parsing error: ".concat(t.message)),f([])}},y=(e,t)=>{p((r=>(0,s.A)((0,s.A)({},r),{},{[e]:t})))},k=e=>{if(!e)return(new Date).toISOString();const t=new Date(e);return isNaN(t.getTime())?(new Date).toISOString():t.toISOString()};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("button",{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.showModal()},className:"w-full bg-green-500 text-white py-2 rounded-md hover:bg-green-600 transition-colors flex items-center justify-center mt-4",children:[(0,m.jsx)(n.A,{className:"mr-2",size:20}),"Bulk Import"]}),(0,m.jsx)("dialog",{ref:r,className:"w-full max-w-3xl rounded-lg p-6 backdrop:bg-black backdrop:bg-opacity-50",children:(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[(0,m.jsx)("h2",{className:"text-xl font-bold",children:"Bulk Import Purchases"}),(0,m.jsx)("button",{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.close()},className:"text-gray-500 hover:text-gray-700",children:(0,m.jsx)(o.A,{size:20})})]}),v&&(0,m.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 text-red-700",children:(0,m.jsxs)("div",{className:"flex",children:[(0,m.jsx)(l.A,{className:"h-5 w-5 mr-2"}),(0,m.jsx)("span",{children:v})]})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Paste your data (tab, comma, or semicolon separated):"}),(0,m.jsxs)("div",{className:"text-xs text-gray-500 mb-2",children:["Example format:",(0,m.jsx)("br",{}),"Item Name,Cost,Date",(0,m.jsx)("br",{}),"Groceries,45.99,2024-02-14"]}),(0,m.jsx)("textarea",{value:u,onChange:e=>{const t=e.target.value;h(t),w(t)},className:"w-full h-32 p-2 border rounded-md font-mono text-sm",placeholder:"Item Name,Cost,Date"})]}),b.length>0&&(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsx)("h3",{className:"font-medium",children:"Map Columns"}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm mb-1",children:"Item Name*"}),(0,m.jsxs)("select",{value:x.itemName,onChange:e=>y("itemName",e.target.value),className:"w-full p-2 border rounded-md",children:[(0,m.jsx)("option",{value:"",children:"Select column"}),b.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm mb-1",children:"Cost*"}),(0,m.jsxs)("select",{value:x.cost,onChange:e=>y("cost",e.target.value),className:"w-full p-2 border rounded-md",children:[(0,m.jsx)("option",{value:"",children:"Select column"}),b.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm mb-1",children:"Date (Optional)"}),(0,m.jsxs)("select",{value:x.date,onChange:e=>y("date",e.target.value),className:"w-full p-2 border rounded-md",children:[(0,m.jsx)("option",{value:"",children:"Select column"}),b.map((e=>(0,m.jsx)("option",{value:e,children:e},e)))]})]})]}),g.length>0&&(0,m.jsxs)("div",{children:[(0,m.jsxs)("h3",{className:"font-medium mb-2",children:["Preview (",g.length," rows)"]}),(0,m.jsx)("div",{className:"max-h-48 overflow-auto border rounded-md",children:(0,m.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,m.jsx)("thead",{className:"bg-gray-50",children:(0,m.jsx)("tr",{children:b.map((e=>(0,m.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e},e)))})}),(0,m.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.slice(0,5).map(((e,t)=>(0,m.jsx)("tr",{children:b.map((t=>(0,m.jsx)("td",{className:"px-4 py-2 text-sm",children:e[t]},t)))},t)))})]})})]})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-2 mt-4 pt-4 border-t",children:[(0,m.jsxs)("button",{onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.close()},className:"px-4 py-2 border rounded-md hover:bg-gray-100",children:[(0,m.jsx)(o.A,{className:"mr-2 inline-block",size:16}),"Cancel"]}),(0,m.jsxs)("button",{onClick:async()=>{const t=x.itemName?x.cost?null:"Cost mapping is required":"Item Name mapping is required";if(t)N(t);else try{var s;const t=g.map((t=>{var r;return{item_name:(null===(r=t[x.itemName])||void 0===r?void 0:r.trim())||"",cost:parseFloat(t[x.cost])||0,user_id:e,budget_item_id:null,timestamp:k(x.date?t[x.date]:null)}})).filter((e=>e.item_name&&!isNaN(e.cost))),{error:a}=await c.A.from("purchases").insert(t);if(a)throw a;alert("Purchases imported successfully!"),null===(s=r.current)||void 0===s||s.close(),h(""),f([]),p({itemName:"",cost:"",date:""})}catch(v){console.error("Error importing purchases:",v),N("Failed to import purchases. Please try again.")}},disabled:!g.length||!x.itemName||!x.cost,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,m.jsx)(i.A,{className:"mr-2 inline-block",size:16}),"Import"]})]})]})})]})}},1088:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var s=r(5043),a=r(4224),n=r(7473),o=r(7750),l=r(1238),i=r(3709),c=r(5983),d=r(579);const m=e=>{let{onToggleIncome:t=()=>{},onToggleRecommended:r=()=>{}}=e;const[m,u]=(0,s.useState)(!1),[h,x]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!1),f=(0,s.useRef)(null),[b,j]=(0,s.useState)(null);(0,s.useEffect)((()=>{(async()=>{const{data:{user:e}}=await i.A.auth.getUser();e&&j(e.id)})()}),[]),(0,s.useEffect)((()=>{if(b){v();const e=i.A.channel("profile_changes_".concat(b)).on("postgres_changes",{event:"*",schema:"public",table:"profiles",match:{id:b}},(()=>v())).subscribe();return()=>{e.unsubscribe()}}}),[b]);const v=async()=>{try{const{data:e,error:s}=await i.A.from("profiles").select("hide_income, hide_recommended_budget").eq("id",b).single();if(s)return void console.error("Error fetching profile data:",s);e&&(x(e.hide_income||!1),g(e.hide_recommended_budget||!1),t(!e.hide_income),r(!e.hide_recommended_budget))}catch(e){console.error("Unexpected error:",e)}},N=async e=>{try{const{error:t}=await i.A.from("profiles").update(e).eq("id",b);t&&console.error("Error updating profile:",t)}catch(t){console.error("Unexpected error:",t)}};return(0,s.useEffect)((()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),(0,d.jsxs)("div",{className:"fixed top-2 right-2 z-50",children:[(0,d.jsx)("button",{onClick:()=>u(!m),className:"p-4 rounded-md bg-blue-200 hover:bg-blue-400 shadow-md transition-colors","aria-label":"Settings",children:(0,d.jsx)(a.A,{className:"w-6 h-6 text-gray-700"})}),m&&(0,d.jsx)("div",{ref:f,className:"absolute right-0 mt-2 w-80 rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:(0,d.jsxs)("div",{className:"p-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Settings"}),(0,d.jsxs)("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-500",children:[(0,d.jsx)("span",{className:"sr-only",children:"Close"}),(0,d.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-md",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Hide Income"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Toggle income visibility"})]}),(0,d.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",checked:h,onChange:async()=>{const e=!h;x(e),t(!e),await N({hide_income:e})},className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-md",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Hide Recommended Budget"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Toggle recommended budget visibility"})]}),(0,d.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",checked:p,onChange:async()=>{const e=!p;g(e),r(!e),await N({hide_recommended_budget:e})},className:"sr-only peer"}),(0,d.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,d.jsxs)("button",{onClick:async()=>{try{const{data:e,error:t}=await i.A.from("budget_groups").select("*").eq("id",b);if(t)throw t;const{data:r,error:s}=await i.A.from("budget_items").select("*").eq("id",b);if(s)throw s;const{data:a,error:n}=await i.A.from("purchases").select("*").eq("id",b);if(n)throw n;const o=r.map((t=>{const r=e.find((e=>e.id===t.group_id));return{Group:(null===r||void 0===r?void 0:r.name)||"Unknown",ItemName:t.name,Budget:t.budget,ItemID:t.id}})),c=a.map((e=>({ItemName:e.item_name,Cost:e.cost,BudgetGroup:e.budget_item_id,Timestamp:new Date(e.timestamp).toLocaleString()}))),d=l.Wp.book_new(),m=l.Wp.json_to_sheet(o);l.Wp.book_append_sheet(d,m,"Budget Items");const u=l.Wp.json_to_sheet(c);l.Wp.book_append_sheet(d,u,"Purchases");const h=l.Wp.json_to_sheet(e);l.Wp.book_append_sheet(d,h,"Budget Groups"),l._h(d,"Budget_Export.xlsx")}catch(e){throw console.error("Error exporting data to Excel: ",e),e}},className:"w-full flex items-center justify-center gap-2 p-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors",children:[(0,d.jsx)(n.A,{className:"w-4 h-4"}),"Export Data"]}),(0,d.jsx)(c.A,{}),(0,d.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,d.jsxs)("button",{onClick:async()=>{try{const{error:e}=await i.A.auth.signOut();if(e)throw e;window.location.href="/"}catch(e){console.error("Error signing out:",e)}},className:"w-full flex items-center justify-center gap-2 p-2 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",children:[(0,d.jsx)(o.A,{className:"w-4 h-4"}),"Sign Out"]})})]})]})})]})}}}]);
//# sourceMappingURL=88.57d5760b.chunk.js.map