/*! For license information please see 173.9145fb60.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkpersonal_finance_tracker=self.webpackChunkpersonal_finance_tracker||[]).push([[173],{5173:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var r=a(9379),n=a(5043);const s=(0,a(1114).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var o=a(7669),i=a(920),c=a(6983),l=a(5349),d=a(7750),m=a(3709),u=a(205),h=a(885),g=a(9554),f=a(579);const p=()=>{const[e,t]=(0,n.useState)(!1),a=(0,n.useRef)(null),[p,y]=(0,n.useState)(null),{theme:w,setTheme:b}=(0,u.D)(),[x,v]=(0,n.useState)(!1),[k,_]=(0,n.useState)(null),[j,A]=(0,n.useState)(!1),[N,I]=(0,n.useState)(null),[S,M]=(0,n.useState)(!1);(0,n.useEffect)((()=>{v(!0)}),[]),(0,n.useEffect)((()=>{(async()=>{const{data:{user:e}}=await m.A.auth.getUser();if(e){y(e.id);const{data:a}=await m.A.from("profiles").select("simplefin_access_url").eq("id",e.id).single();if(null!==a&&void 0!==a&&a.simplefin_access_url)try{const t=(0,h.jO)(a.simplefin_access_url,e.id);t&&t.startsWith("http")&&_(t)}catch(t){console.error("Error decrypting SimpleFin URL:",t)}}})()}),[]);const E=async e=>{try{const{data:t}=await m.A.from("purchases").select("simplefin_transaction_id, simplefin_account_id, is_deleted").eq("user_id",p),{transactionsToCreate:a}=await(0,g.fm)(k,e,t||[]);if(0===a.length)return void console.log("No new transactions to sync");console.log("Syncing ".concat(a.length," new transactions"));for(const e of a)await m.A.from("purchases").insert([(0,r.A)((0,r.A)({},e),{},{user_id:p})]);console.log("Successfully synced ".concat(a.length," transactions"))}catch(t){console.error("Transaction sync error:",t)}};return(0,n.useEffect)((()=>{const e=e=>{a.current&&!a.current.contains(e.target)&&t(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),(0,f.jsxs)("div",{className:"z-50",children:[(0,f.jsx)("button",{onClick:()=>t(!e),className:"relative p-4 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-slate-700 dark:to-slate-800 hover:from-gray-200 hover:to-gray-300 dark:hover:from-slate-600 dark:hover:to-slate-700 shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-300 dark:border-gray-600 group","aria-label":"Settings",children:(0,f.jsx)(s,{className:"w-6 h-6 text-gray-700 dark:text-gray-200 group-hover:rotate-45 transition-transform duration-300"})}),e&&(0,f.jsxs)("div",{ref:a,className:"absolute right-0 mt-3 w-96 rounded-xl bg-white dark:bg-slate-800 shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,f.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700 px-6 py-4",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:(0,f.jsx)(s,{className:"w-5 h-5 text-white"})}),(0,f.jsx)("h2",{className:"text-xl font-bold text-white",children:"Settings"})]}),(0,f.jsx)("button",{onClick:()=>t(!1),className:"p-1.5 rounded-lg text-white/80 hover:text-white hover:bg-white/20 transition-all duration-200","aria-label":"Close settings",children:(0,f.jsx)(o.A,{className:"w-5 h-5"})})]})}),(0,f.jsxs)("div",{className:"p-5 space-y-4 max-h-[600px] overflow-y-auto",children:[x&&(0,f.jsx)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-slate-700/50 dark:to-slate-700/30 rounded-xl p-4 border border-gray-200/50 dark:border-gray-600/50 shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("div",{className:"p-2 bg-white dark:bg-slate-600 rounded-lg shadow-sm",children:"dark"===w?(0,f.jsx)(i.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}):(0,f.jsx)(c.A,{className:"w-5 h-5 text-amber-500"})}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Appearance"}),(0,f.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:["dark"===w?"Dark":"Light"," mode"]})]})]}),(0,f.jsx)("button",{onClick:()=>b("dark"===w?"light":"dark"),className:"relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 bg-gray-300 dark:bg-indigo-600","aria-label":"Toggle theme",children:(0,f.jsx)("span",{className:"".concat("dark"===w?"translate-x-7":"translate-x-1"," inline-block h-6 w-6 transform rounded-full bg-white shadow-lg transition-transform duration-200")})})]})}),k&&(0,f.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-4 border border-green-200/50 dark:border-green-700/50 shadow-sm space-y-3",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,f.jsx)("div",{className:"p-1.5 bg-green-100 dark:bg-green-800/50 rounded-lg",children:(0,f.jsx)(l.A,{className:"w-4 h-4 text-green-700 dark:text-green-400"})}),(0,f.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"SimpleFin Integration"})]}),(0,f.jsxs)("button",{onClick:async()=>{if(k&&p){A(!0);try{const{data:e}=await m.A.from("accounts").select("*").eq("user_id",p),t=(e||[]).map((e=>(0,r.A)((0,r.A)({},e),{},{value:(0,h.pN)(e.value,p),interest_rate:(0,h.pN)(e.interest_rate,p),montly_contribution:(0,h.pN)(e.montly_contribution,p)}))),{accountsToCreate:a,accountsToUpdate:n}=await(0,g.cw)(k,t);console.log("Sync results:",{toCreate:a.length,toUpdate:n.length,newAccounts:a});const s=[];for(const i of a){console.log("Creating new account:",i);const e=(0,h.Rb)(i.value,p),t=(0,h.Rb)(i.interest_rate,p),a=(0,h.Rb)(i.montly_contribution,p),{data:n,error:o}=await m.A.from("accounts").insert([(0,r.A)((0,r.A)({},i),{},{value:e,interest_rate:t,montly_contribution:a,user_id:p})]).select();if(o)throw console.error("Error inserting account:",o),o;console.log("Account created successfully:",n),n&&n[0]&&s.push((0,r.A)((0,r.A)({},n[0]),{},{value:i.value,interest_rate:i.interest_rate,montly_contribution:i.montly_contribution}))}for(const r of n){const e=(0,h.Rb)(r.value,p),t=(0,h.Rb)(r.interest_rate,p),a=(0,h.Rb)(r.montly_contribution,p);await m.A.from("accounts").update({value:e,interest_rate:t,montly_contribution:a,account_type:r.account_type,type:r.type,last_synced:r.last_synced,is_simplefin_synced:!0}).eq("id",r.id)}const o=[...t,...s];await E(o),I(new Date)}catch(e){console.error("SimpleFin sync error:",e),alert("Failed to sync accounts. Please try again.")}finally{A(!1)}}},disabled:j,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 dark:from-green-700 dark:to-emerald-700 dark:hover:from-green-800 dark:hover:to-emerald-800 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:shadow-md",children:[(0,f.jsx)(l.A,{className:"w-4 h-4 ".concat(j?"animate-spin":"")}),j?"Syncing Accounts...":"Sync Accounts Now"]}),N&&(0,f.jsxs)("div",{className:"flex items-center justify-center gap-1.5 text-xs text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-800/30 rounded-lg py-1.5 px-3",children:[(0,f.jsx)("svg",{className:"w-3.5 h-3.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),(0,f.jsxs)("span",{children:["Last synced: ",N.toLocaleTimeString()]})]}),(0,f.jsxs)("button",{onClick:()=>M(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-red-700 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-all duration-200 border border-red-200/50 dark:border-red-800/50",children:[(0,f.jsx)(o.A,{className:"w-4 h-4"}),"Disconnect SimpleFin"]})]}),(0,f.jsx)("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("button",{onClick:async()=>{try{const{error:e}=await m.A.auth.signOut();if(e)throw e;window.location.href="/"}catch(e){console.error("Error signing out:",e)}},className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-semibold text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md border border-red-200/50 dark:border-red-800/50 group",children:[(0,f.jsx)(d.A,{className:"w-4 h-4 group-hover:translate-x-0.5 transition-transform"}),"Sign Out"]})})]})]}),S&&(0,f.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4 animate-in fade-in duration-200",children:(0,f.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 dark:border-gray-700 overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,f.jsx)("div",{className:"bg-gradient-to-r from-red-500 to-orange-600 dark:from-red-600 dark:to-orange-700 px-6 py-4",children:(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:(0,f.jsx)(o.A,{className:"w-6 h-6 text-white"})}),(0,f.jsx)("h3",{className:"text-xl font-bold text-white",children:"Disconnect SimpleFin?"})]})}),(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsxs)("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed mb-6",children:["Your synced accounts will remain, but they will ",(0,f.jsx)("strong",{children:"no longer automatically update"}),". You can reconnect SimpleFin anytime from the Accounts page."]}),(0,f.jsxs)("div",{className:"flex gap-3",children:[(0,f.jsx)("button",{onClick:()=>M(!1),className:"flex-1 px-4 py-3 bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-200 rounded-xl font-semibold hover:bg-gray-200 dark:hover:bg-slate-600 transition-all duration-200 shadow-sm hover:shadow-md border border-gray-300 dark:border-gray-600",children:"Cancel"}),(0,f.jsx)("button",{onClick:async()=>{try{await m.A.from("profiles").update({simplefin_access_url:null}).eq("id",p),_(null),I(null),M(!1),t(!1)}catch(e){console.error("Error disconnecting SimpleFin:",e),alert("Failed to disconnect SimpleFin.")}},className:"flex-1 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 dark:from-red-600 dark:to-red-700 dark:hover:from-red-700 dark:hover:to-red-800 text-white rounded-xl font-semibold transition-all duration-200 shadow-md hover:shadow-lg",children:"Disconnect"})]})]})]})})]})}},9554:(e,t,a)=>{a.d(t,{Mc:()=>n,cw:()=>l,fm:()=>d});var r=a(9379);async function n(e){try{const t=atob(e.trim());if(!t.startsWith("http"))throw new Error("Invalid setup token format");const a="https://gzuyfuwdajaqwvkcptuf.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd6dXlmdXdkYWphcXd2a2NwdHVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MzkwMjYsImV4cCI6MjA1MzUxNTAyNn0.bm_usDFy_wYZtI643RAEYxrl24jk6CYtYVwWjpMaZGI",n=await fetch("".concat(a,"/functions/v1/simplefin-proxy"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({url:t,method:"POST"})}),s=await n.text();if(!n.ok){if(429===n.status)throw new Error("RATE_LIMIT: Too many requests. Please wait a moment and try again.");throw new Error("Edge Function error (".concat(n.status,"): ").concat(s))}const o=s;if(!o||!o.startsWith("http"))throw new Error("Invalid response from SimpleFin");return o.trim()}catch(t){if("RATE_LIMIT"===t.message)throw t;if("InvalidCharacterError"===t.name)throw new Error("Invalid setup token. Please check and try again.");throw new Error("Failed to claim access URL: ".concat(t.message))}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!e||!e.startsWith("http"))throw new Error("Invalid access URL");let a="".concat(e,"/accounts");const r=[];t.startDate&&r.push("start-date=".concat(t.startDate)),t.endDate&&r.push("end-date=".concat(t.endDate)),r.length>0&&(a+="?".concat(r.join("&")));const n="https://gzuyfuwdajaqwvkcptuf.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd6dXlmdXdkYWphcXd2a2NwdHVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MzkwMjYsImV4cCI6MjA1MzUxNTAyNn0.bm_usDFy_wYZtI643RAEYxrl24jk6CYtYVwWjpMaZGI",o=await fetch("".concat(n,"/functions/v1/simplefin-proxy"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({url:a,method:"GET"})});if(!o.ok){if(429===o.status){const e=o.headers.get("Retry-After");throw new Error("RATE_LIMIT:".concat(e||"60"))}if(401===o.status||403===o.status)throw new Error("UNAUTHORIZED: Access URL is invalid or expired. Please reconnect SimpleFin.");throw new Error("Failed to fetch accounts: ".concat(o.statusText))}return await o.json()}catch(a){if(a.message.startsWith("RATE_LIMIT")||a.message.startsWith("UNAUTHORIZED"))throw a;throw new Error("Failed to fetch accounts: ".concat(a.message))}}function o(e){var t;let a=0;void 0!==e.balance&&null!==e.balance&&(a=parseFloat(e.balance)),0===a&&void 0!==e.available_balance&&null!==e.available_balance&&(a=parseFloat(e.available_balance));let r="other";const n=(null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"";return n.includes("checking")||n.includes("debit")?r="checking":n.includes("savings")?r="savings":n.includes("credit")||a<0?r="credit":n.includes("loan")||n.includes("mortgage")?r="loan":(n.includes("investment")||n.includes("brokerage")||n.includes("401k")||n.includes("ira"))&&(r="investment"),"credit"!==r&&"loan"!==r||(a=Math.abs(a)),{simplefin_id:e.id,name:e.name||"Unnamed Account",account_type:r,value:a,is_simplefin_synced:!0,last_synced:(new Date).toISOString(),interest_rate:0,montly_contribution:0}}async function i(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let n=0;n<a;n++)try{return await e()}catch(r){if(t=r,r.message.startsWith("UNAUTHORIZED")||r.message.includes("Invalid setup token")||r.message.includes("Invalid access URL"))throw r;if(r.message.startsWith("RATE_LIMIT")){const e=r.message.split(":"),t=e.length>1?parseInt(e[1]):60;if(n<a-1){await new Promise((e=>setTimeout(e,1e3*t)));continue}throw r}if(n<a-1){const e=1e3*Math.pow(2,n);await new Promise((t=>setTimeout(t,e)))}}throw t}function c(e,t,a){const r=Math.abs(parseFloat(e.amount)||0);if(e.amount>=0||0===r)return null;let n=new Date;return e.posted?n=new Date(1e3*e.posted):e.transacted_at&&(n=new Date(1e3*e.transacted_at)),{simplefin_transaction_id:e.id,simplefin_account_id:a,item_name:e.description||e.payee||"Unknown Transaction",cost:r,timestamp:n.toISOString(),is_simplefin_synced:!0,budget_item_id:null}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{const a=await i((()=>s(e)));if(!a||!a.accounts||!Array.isArray(a.accounts))throw new Error("Invalid response format from SimpleFin");const n=[],c=[];for(const e of a.accounts){const a=o(e),s=t.find((e=>e.simplefin_id===a.simplefin_id));s?c.push((0,r.A)((0,r.A)({id:s.id},a),{},{interest_rate:s.interest_rate,montly_contribution:s.montly_contribution,name:s.name||a.name})):n.push(a)}return{accountsToCreate:n,accountsToUpdate:c,totalSynced:a.accounts.length,rawData:a}}catch(a){throw a}}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{const r=Math.floor(Date.now()/1e3),n=r-7776e3,o=await i((()=>s(e,{startDate:n,endDate:r})));if(!o||!o.accounts||!Array.isArray(o.accounts))throw new Error("Invalid response format from SimpleFin");const l=[],d=new Set(a.filter((e=>e.simplefin_transaction_id)).map((e=>e.simplefin_transaction_id)));for(const e of o.accounts){const a=t.find((t=>t.simplefin_id===e.id));if(a&&(e.transactions&&Array.isArray(e.transactions)))for(const t of e.transactions){if(d.has(t.id))continue;const r=c(t,a.id,e.id);r&&l.push(r)}}return{transactionsToCreate:l,totalSynced:l.length}}catch(r){throw r}}},7750:(e,t,a)=>{a.d(t,{A:()=>r});const r=(0,a(1114).A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},920:(e,t,a)=>{a.d(t,{A:()=>r});const r=(0,a(1114).A)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]])},5349:(e,t,a)=>{a.d(t,{A:()=>r});const r=(0,a(1114).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},6983:(e,t,a)=>{a.d(t,{A:()=>r});const r=(0,a(1114).A)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]])},7669:(e,t,a)=>{a.d(t,{A:()=>r});const r=(0,a(1114).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}}]);
//# sourceMappingURL=173.9145fb60.chunk.js.map